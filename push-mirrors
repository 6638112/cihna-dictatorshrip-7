#!/usr/bin/env bash

# https://github.com/cirosantilli/china-dictatorship#mirrors

set -eux

make

# NPM package.
# Updates package.json version, which other systems read if possible.
./push-mirrors-bump-package-json-version
npm publish
git add package.json

# Python package.
# Initial one time setup.
./push-mirrors-bump-setup-py-version
python -m pip install --user setuptools wheel twine
cp README.adoc README.html china_dictatorship
python setup.py sdist bdist_wheel
# Asks for username and password every time, unless you setup ~/.pypirc.
twine upload dist/*
rm -rf build dist *.egg-info
git add setup.py

# Bump package versions
git commit -m 'bump package version'
git push

git push git@gitlab.com:cirosantilli/china-dictatorship.git
git push git@bitbucket.org:cirosantilli/china-dictatorship.git
